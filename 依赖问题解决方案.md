# 依赖安装问题解决方案

## 问题描述

安装依赖时遇到 `pandas` 和 `numpy` 构建失败的错误。这是因为：
- `pandas` 需要编译 C 扩展
- 在某些 Windows 系统上可能缺少必要的编译工具
- `numpy` 的构建过程可能失败

## 解决方案

### 方案一：使用精简依赖（推荐）⭐

我已经从 `requirements.txt` 中移除了 `pandas` 和 `openpyxl`，因为：
- 代码中目前没有使用这些库
- 这些库主要用于数据导出功能（未来可能用到）

**现在可以直接安装依赖：**
```powershell
.\install.bat
```

### 方案二：如果需要导出功能

如果将来需要 CSV/Excel 导出功能，可以安装可选依赖：

```powershell
# 先安装基础依赖
.\install.bat

# 然后安装可选依赖（如果需要）
venv\Scripts\python.exe -m pip install -r requirements-optional.txt
```

### 方案三：手动安装 pandas（如果必须）

如果确实需要 pandas，可以尝试：

1. **使用预编译的 wheel 包**：
   ```powershell
   venv\Scripts\python.exe -m pip install --only-binary :all: pandas
   ```

2. **安装 Visual C++ 构建工具**：
   - 下载并安装：https://visualstudio.microsoft.com/visual-cpp-build-tools/
   - 选择 "C++ build tools" 工作负载

3. **使用 conda**（如果已安装）：
   ```powershell
   conda install pandas
   ```

## 当前状态

✅ **基础功能完全可用**，无需 pandas：
- AD 用户管理
- 自助服务
- 审计日志
- 系统配置

❌ **暂时不可用**（需要 pandas）：
- CSV/Excel 导出功能（代码中尚未实现）

## 验证安装

安装完成后，验证核心依赖：

```powershell
venv\Scripts\python.exe -c "import flask, ldap3, flask_jwt_extended; print('Core dependencies OK')"
```

如果看到 "Core dependencies OK"，说明核心功能可以正常使用。

## 如果仍有问题

1. **检查 Python 版本**：
   ```powershell
   python --version
   ```
   需要 Python 3.8 或更高版本

2. **升级 pip**：
   ```powershell
   venv\Scripts\python.exe -m pip install --upgrade pip
   ```

3. **清理并重新安装**：
   ```powershell
   # 删除虚拟环境
   Remove-Item -Recurse -Force venv
   
   # 重新创建并安装
   .\install.bat
   ```


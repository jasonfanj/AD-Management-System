<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.admanagement.repository.AdOperationAuditMapper">
    
    <!-- 基础结果映射 -->
    <resultMap id="BaseResultMap" type="com.admanagement.entity.AdOperationAudit">
        <id column="id" property="id" />
        <result column="operator_id" property="operatorId" />
        <result column="operator_username" property="operatorUsername" />
        <result column="operator_name" property="operatorName" />
        <result column="operation_module" property="operationModule" />
        <result column="operation_type" property="operationType" />
        <result column="operation_content" property="operationContent" />
        <result column="operation_detail" property="operationDetail" />
        <result column="operation_ip" property="operationIp" />
        <result column="operation_time" property="operationTime" />
        <result column="operation_result" property="operationResult" />
        <result column="error_message" property="errorMessage" />
        <result column="request_url" property="requestUrl" />
        <result column="request_method" property="requestMethod" />
        <result column="execution_time" property="executionTime" />
        <result column="create_time" property="createTime" />
    </resultMap>
    
    <!-- 查询字段 -->
    <sql id="Base_Column_List">
        id, operator_id, operator_username, operator_name, operation_module,
        operation_type, operation_content, operation_detail, operation_ip,
        operation_time, operation_result, error_message, request_url,
        request_method, execution_time, create_time
    </sql>
    
    <!-- 查询条件 -->
    <sql id="Where_Clause">
        <where>
            <if test="query.operatorUsername != null and query.operatorUsername != ''">
                AND operator_username LIKE CONCAT('%', #{query.operatorUsername}, '%')
            </if>
            <if test="query.operationModule != null and query.operationModule != ''">
                AND operation_module = #{query.operationModule}
            </if>
            <if test="query.operationType != null and query.operationType != ''">
                AND operation_type = #{query.operationType}
            </if>
            <if test="query.operationResult != null">
                AND operation_result = #{query.operationResult}
            </if>
            <if test="query.startTime != null">
                AND operation_time &gt;= #{query.startTime}
            </if>
            <if test="query.endTime != null">
                AND operation_time &lt;= #{query.endTime}
            </if>
        </where>
    </sql>
    
    <!-- 分页查询审计日志列表 -->
    <select id="selectAuditLogList" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM ad_operation_audit
        <include refid="Where_Clause"/>
        ORDER BY operation_time DESC
        LIMIT #{query.pageSize} OFFSET #{query.offset}
    </select>
    
    <!-- 统计审计日志数量 -->
    <select id="countAuditLogList" resultType="long">
        SELECT COUNT(1)
        FROM ad_operation_audit
        <include refid="Where_Clause"/>
    </select>
    
</mapper>

